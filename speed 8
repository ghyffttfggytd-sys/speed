-- Services
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")

local player = Players.LocalPlayer
local highlightList = {}
local espEnabled = true
local mBotEnabled = false
local mBotValue = 100

-- ฟังก์ชันสร้าง Highlight
local function highlightEnemy(character)
    if highlightList[character] then return end
    local hl = Instance.new("Highlight")
    hl.FillColor = Color3.fromRGB(255,0,0)
    hl.OutlineColor = Color3.fromRGB(255,0,0)
    hl.Parent = character
    highlightList[character] = hl
end

-- ฟังก์ชันอัพเดท ESP
local function updateESP()
    for _, plr in pairs(Players:GetPlayers()) do
        if plr ~= player and plr.Character then
            highlightEnemy(plr.Character)
        end
    end
end

-- GUI
local gui = Instance.new("ScreenGui", player:WaitForChild("PlayerGui"))
gui.ResetOnSpawn = false

-- ปุ่มเปิด/ปิด เมนู
local toggleUIButton = Instance.new("TextButton", gui)
toggleUIButton.Size = UDim2.new(0,50,0,50)
toggleUIButton.Position = UDim2.new(0,10,0,10)
toggleUIButton.Text = "❌"
toggleUIButton.TextScaled = true
toggleUIButton.BackgroundColor3 = Color3.fromRGB(255,50,50)
toggleUIButton.TextColor3 = Color3.new(1,1,1)
toggleUIButton.BorderSizePixel = 0
toggleUIButton.ZIndex = 10

-- เมนูหลัก
local menuFrame = Instance.new("Frame", gui)
menuFrame.Size = UDim2.new(0,220,0,200)
menuFrame.Position = UDim2.new(0,70,0,10)
menuFrame.BackgroundColor3 = Color3.fromRGB(50,50,50)
menuFrame.BorderSizePixel = 1
menuFrame.BorderColor3 = Color3.fromRGB(255,0,0)
menuFrame.ZIndex = 10

-- ปุ่ม ESP
local espButton = Instance.new("TextButton", menuFrame)
espButton.Size = UDim2.new(1,-20,0,40)
espButton.Position = UDim2.new(0,10,0,10)
espButton.Text = "ESP: เปิด"
espButton.TextScaled = true
espButton.BackgroundColor3 = Color3.fromRGB(0,150,0)
espButton.TextColor3 = Color3.new(1,1,1)
espButton.BorderSizePixel = 0

espButton.MouseButton1Click:Connect(function()
    espEnabled = not espEnabled
    if espEnabled then
        espButton.Text = "ESP: เปิด"
        espButton.BackgroundColor3 = Color3.fromRGB(0,150,0)
    else
        espButton.Text = "ESP: ปิด"
        espButton.BackgroundColor3 = Color3.fromRGB(150,0,0)
        for _,hl in pairs(highlightList) do
            if hl and hl.Parent then hl:Destroy() end
        end
        highlightList = {}
    end
end)

-- ปุ่ม M Bot
local mBotButton = Instance.new("TextButton", menuFrame)
mBotButton.Size = UDim2.new(1,-20,0,40)
mBotButton.Position = UDim2.new(0,10,0,60)
mBotButton.Text = "M Bot: ปิด"
mBotButton.TextScaled = true
mBotButton.BackgroundColor3 = Color3.fromRGB(150,0,0)
mBotButton.TextColor3 = Color3.new(1,1,1)
mBotButton.BorderSizePixel = 0

mBotButton.MouseButton1Click:Connect(function()
    mBotEnabled = not mBotEnabled
    if mBotEnabled then
        mBotButton.Text = "M Bot: เปิด"
        mBotButton.BackgroundColor3 = Color3.fromRGB(0,150,0)
    else
        mBotButton.Text = "M Bot: ปิด"
        mBotButton.BackgroundColor3 = Color3.fromRGB(150,0,0)
    end
end)

-- Label แสดงค่า M Bot
local mBotLabel = Instance.new("TextLabel", menuFrame)
mBotLabel.Size = UDim2.new(1,-20,0,30)
mBotLabel.Position = UDim2.new(0,10,0,110)
mBotLabel.Text = "ค่า M Bot: "..mBotValue
mBotLabel.TextScaled = true
mBotLabel.BackgroundTransparency = 1
mBotLabel.TextColor3 = Color3.new(1,1,1)

-- ปุ่มปรับค่า M Bot (+/-)
local increaseBtn = Instance.new("TextButton", menuFrame)
increaseBtn.Size = UDim2.new(0.45,-5,0,30)
increaseBtn.Position = UDim2.new(0,10,0,140)
increaseBtn.Text = "+"
increaseBtn.TextScaled = true
increaseBtn.BackgroundColor3 = Color3.fromRGB(0,150,0)
increaseBtn.TextColor3 = Color3.new(1,1,1)

local decreaseBtn = Instance.new("TextButton", menuFrame)
decreaseBtn.Size = UDim2.new(0.45,-5,0,30)
decreaseBtn.Position = UDim2.new(0.5,0,0,140)
decreaseBtn.Text = "-"
decreaseBtn.TextScaled = true
decreaseBtn.BackgroundColor3 = Color3.fromRGB(150,0,0)
decreaseBtn.TextColor3 = Color3.new(1,1,1)

increaseBtn.MouseButton1Click:Connect(function()
    mBotValue = math.clamp(mBotValue + 1,1,400)
    mBotLabel.Text = "ค่า M Bot: "..mBotValue
end)

decreaseBtn.MouseButton1Click:Connect(function()
    mBotValue = math.clamp(mBotValue - 1,1,400)
    mBotLabel.Text = "ค่า M Bot: "..mBotValue
end)

-- เปิด/ปิด เมนู
local uiOpen = true
toggleUIButton.MouseButton1Click:Connect(function()
    uiOpen = not uiOpen
    menuFrame.Visible = uiOpen
    toggleUIButton.Text = uiOpen and "❌" or "✔️"
end)

-- ฟังก์ชันลากเมนู
local dragging = false
local dragInput, startPos, startFramePos

local function update(input)
    local delta = input.Position - startPos
    menuFrame.Position = UDim2.new(0, startFramePos.X + delta.X, 0, startFramePos.Y + delta.Y)
end

menuFrame.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        startPos = input.Position
        startFramePos = Vector2.new(menuFrame.Position.X.Offset, menuFrame.Position.Y.Offset)
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end)

menuFrame.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
        dragInput = input
    end
end)

RunService.RenderStepped:Connect(function()
    if dragging and dragInput then
        update(dragInput)
    end
end)

-- Loop ESP ทุก 1 วินาที
while true do
    if espEnabled then
        updateESP()
    end
    wait(1)
end
