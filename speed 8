--// Services
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")
local UserInputService = game:GetService("UserInputService")

local LocalPlayer = Players.LocalPlayer
local Camera = Workspace.CurrentCamera

--// Settings
local espEnabled = true
local lockTargetEnabled = true
local enemyColor = Color3.fromRGB(255,0,0)
local friendColor = Color3.fromRGB(0,255,0)

--// Highlight เก็บ ESP
local highlights = {}
local currentTarget = nil

--// ฟังก์ชันสร้าง ESP
local function createESP(player)
    if highlights[player] then return highlights[player] end

    local highlight = Instance.new("Highlight")
    highlight.Adornee = player.Character
    highlight.FillColor = (player.Team == LocalPlayer.Team and friendColor) or enemyColor
    highlight.OutlineColor = Color3.new(1,1,1)
    highlight.Parent = game.CoreGui
    highlights[player] = highlight
    return highlight
end

--// ฟังก์ชันลบ ESP
local function removeESP(player)
    if highlights[player] then
        highlights[player]:Destroy()
        highlights[player] = nil
    end
end

--// ฟังก์ชันหาศัตรูใกล้กลางจอ
local function getCenterTarget()
    local closest = nil
    local shortestDistance = math.huge

    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            local screenPos, onScreen = Camera:WorldToViewportPoint(player.Character.HumanoidRootPart.Position)
            if onScreen then
                local distance = (Vector2.new(screenPos.X, screenPos.Y) - Vector2.new(Camera.ViewportSize.X/2, Camera.ViewportSize.Y/2)).Magnitude
                if distance < shortestDistance then
                    shortestDistance = distance
                    closest = player
                end
            end
        end
    end
    return closest
end

--// เรียลไทม์
RunService.RenderStepped:Connect(function()
    if espEnabled then
        for _, player in pairs(Players:GetPlayers()) do
            if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
                createESP(player)
            end
        end
    else
        for player, _ in pairs(highlights) do
            removeESP(player)
        end
    end

    if lockTargetEnabled then
        currentTarget = getCenterTarget()
        if currentTarget then
            -- ตัวอย่าง: แสดงชื่อเป้าล็อค
            print("Locked Target:", currentTarget.Name)
        end
    end
end)

--// UI เมนูเลื่อนได้
local ScreenGui = Instance.new("ScreenGui", game.CoreGui)
local MenuFrame = Instance.new("Frame", ScreenGui)
MenuFrame.Size = UDim2.new(0,150,0,120)
MenuFrame.Position = UDim2.new(0,50,0,50)
MenuFrame.BackgroundColor3 = Color3.fromRGB(30,30,30)
MenuFrame.Active = true
MenuFrame.Draggable = true -- สามารถลากได้

-- ปุ่ม ESP
local ESPButton = Instance.new("TextButton", MenuFrame)
ESPButton.Size = UDim2.new(0,130,0,40)
ESPButton.Position = UDim2.new(0,10,0,10)
ESPButton.Text = "ESP ✔️"
ESPButton.MouseButton1Click:Connect(function()
    espEnabled = not espEnabled
    ESPButton.Text = espEnabled and "ESP ✔️" or "ESP ❌"
end)

-- ปุ่ม Lock
local LockButton = Instance.new("TextButton", MenuFrame)
LockButton.Size = UDim2.new(0,130,0,40)
LockButton.Position = UDim2.new(0,10,0,60)
LockButton.Text = "Lock ✔️"
LockButton.MouseButton1Click:Connect(function()
    lockTargetEnabled = not lockTargetEnabled
    LockButton.Text = lockTargetEnabled and "Lock ✔️" or "Lock ❌"
end)
