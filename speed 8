--// Services
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")

local LocalPlayer = Players.LocalPlayer
local Camera = Workspace.CurrentCamera

--// Settings
local espEnabled = true
local lockAllEnabled = true
local refreshRate = 0.3 -- รีเฟรช ESP ทุก 0.3 วินาที
local enemyColor = Color3.fromRGB(255,0,0)
local friendColor = Color3.fromRGB(0,255,0)

--// เก็บ Highlight
local highlights = {}
local lockedTargets = {}

--// ฟังก์ชันสร้าง ESP
local function createESP(player)
    if highlights[player] then return highlights[player] end
    if not player.Character then return end

    local highlight = Instance.new("Highlight")
    highlight.Adornee = player.Character
    highlight.FillColor = (player.Team == LocalPlayer.Team and friendColor) or enemyColor
    highlight.OutlineColor = Color3.fromRGB(255,255,255)
    highlight.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop -- เห็นผ่านผนัง
    highlight.Parent = game.CoreGui
    highlights[player] = highlight
    return highlight
end

--// ฟังก์ชันลบ ESP ทั้งหมด
local function clearESP()
    for player, _ in pairs(highlights) do
        highlights[player]:Destroy()
        highlights[player] = nil
    end
end

--// ฟังก์ชันอัปเดต ESP ทุก refreshRate
spawn(function()
    while true do
        if espEnabled then
            clearESP()
            for _, player in pairs(Players:GetPlayers()) do
                if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
                    createESP(player)
                end
            end
        else
            clearESP()
        end
        wait(refreshRate)
    end
end)

--// ระบบล็อคเป้าทุกคน
RunService.RenderStepped:Connect(function()
    if lockAllEnabled then
        lockedTargets = {}
        for _, player in pairs(Players:GetPlayers()) do
            if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
                table.insert(lockedTargets, player)
                -- ตัวอย่าง: แสดงชื่อเป้าล็อค
                print("Locked Target:", player.Name)
            end
        end
    end
end)

--// GUI มืออาชีพ
local ScreenGui = Instance.new("ScreenGui", game.CoreGui)
local MenuFrame = Instance.new("Frame", ScreenGui)
MenuFrame.Size = UDim2.new(0,180,0,160)
MenuFrame.Position = UDim2.new(0,50,0,50)
MenuFrame.BackgroundColor3 = Color3.fromRGB(40,40,40)
MenuFrame.BorderSizePixel = 0
MenuFrame.Active = true
MenuFrame.Draggable = true
MenuFrame.Name = "ProMenu"

-- ขอบและโค้ง
local UIStroke = Instance.new("UIStroke", MenuFrame)
UIStroke.Color = Color3.fromRGB(0,255,128)
UIStroke.Thickness = 2

local UICorner = Instance.new("UICorner", MenuFrame)
UICorner.CornerRadius = UDim.new(0,12)

-- ปุ่ม ESP
local ESPButton = Instance.new("TextButton", MenuFrame)
ESPButton.Size = UDim2.new(0,160,0,50)
ESPButton.Position = UDim2.new(0,10,0,10)
ESPButton.BackgroundColor3 = Color3.fromRGB(0,128,255)
ESPButton.TextColor3 = Color3.fromRGB(255,255,255)
ESPButton.Font = Enum.Font.GothamBold
ESPButton.TextSize = 20
ESPButton.Text = "ESP ✔️"
local ESPCorner = Instance.new("UICorner", ESPButton)
ESPCorner.CornerRadius = UDim.new(0,8)

ESPButton.MouseButton1Click:Connect(function()
    espEnabled = not espEnabled
    ESPButton.Text = espEnabled and "ESP ✔️" or "ESP ❌"
end)

-- ปุ่ม Lock All
local LockButton = Instance.new("TextButton", MenuFrame)
LockButton.Size = UDim2.new(0,160,0,50)
LockButton.Position = UDim2.new(0,10,0,80)
LockButton.BackgroundColor3 = Color3.fromRGB(255,64,64)
LockButton.TextColor3 = Color3.fromRGB(255,255,255)
LockButton.Font = Enum.Font.GothamBold
LockButton.TextSize = 20
LockButton.Text = "Lock All ✔️"
local LockCorner = Instance.new("UICorner", LockButton)
LockCorner.CornerRadius = UDim.new(0,8)

LockButton.MouseButton1Click:Connect(function()
    lockAllEnabled = not lockAllEnabled
    LockButton.Text = lockAllEnabled and "Lock All ✔️" or "Lock All ❌"
end)

-- ปุ่ม Refresh Rate Info (ตัวอย่าง)
local InfoLabel = Instance.new("TextLabel", MenuFrame)
InfoLabel.Size = UDim2.new(0,160,0,20)
InfoLabel.Position = UDim2.new(0,10,0,140)
InfoLabel.BackgroundTransparency = 1
InfoLabel.TextColor3 = Color3.fromRGB(200,200,200)
InfoLabel.TextSize = 14
InfoLabel.Font = Enum.Font.Gotham
InfoLabel.Text = "ESP Refresh: 0.3s"
